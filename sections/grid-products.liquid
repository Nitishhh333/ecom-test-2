{{ 'component-card.css' | asset_url | stylesheet_tag }}
<script>
      document.addEventListener('DOMContentLoaded', function () {
      const changeOptions = (product) => {
        document.querySelectorAll(".main-options input,.main-options select").forEach((e) => {
            e.addEventListener("change",(evt) => {
                const selectedValues = [];
                var checked_color = document.querySelectorAll(".main-options input:checked")[0]?.value || null;
                var checked_size = document.querySelectorAll(".main-options select")[0]?.value || null;
                if(checked_color && checked_size){
                    var checked_value = checked_size+' / '+checked_color;
                    var match_title = Number(evt.target.closest(".pro-information").querySelector(".all_variants_main input[data-title='"+ checked_value +"']").value);
                    var Selected_Variant = Number(
                        evt.target.closest(".pro-information")
                            .querySelector(".all_variants_main input[data-title='" + checked_value + "']")
                            .value
                        );
                    document.querySelector(".custom-quick-add").dataset.id = Selected_Variant;
                    const priceElement = document.querySelector(".pro-information .price");
                    if (priceElement) {
                        const matchedVariant = Array.from(
                            evt.target.closest(".pro-information").querySelectorAll(".all_variants_main input")
                        ).find(input => Number(input.value) === Selected_Variant);
    
                        if (matchedVariant) {
                            const variant = product.variants.find(v => v.id === Selected_Variant);
                            if (variant) {
                            priceElement.textContent = variant.price;
                            }
                        }
                    }
    
                    Add_to_cart();

                }
            })
        })
      };
      const Add_to_cart_function = (id) => {
        let formData = {
           'items': [{
            'id': id,
            'quantity': 1
            }]
          };
          fetch(window.Shopify.routes.root + 'cart/add.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          })
          .then(response => {
            return response.json();
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      };
      const Add_to_cart = () => {
        document.querySelector(".custom-quick-add").addEventListener("click", (e) => {
          var var_id = Number(e.target.dataset.id);
          Add_to_cart_function(var_id);
        })
      }
        
      document.querySelectorAll(".custom-quickview").forEach((e) => {
          e.addEventListener("click",function(evt){
              var $gt_handle = evt.target.dataset.handle;
              fetch(`/products/${$gt_handle}.json`).then((response)=>{
                  return response.json()
              }).then((data) => {
                
                var $product = data.product;
                console.log("$product--->",$product)
                
                // variant options js starts from here
                var variant_options = document.createElement("div");
                variant_options.setAttribute("class",`main-options`);
                $product.options.forEach((option) => {
                    let wrapper = document.createElement("div");
                    wrapper.classList.add(`option-${option.name}`);
                    let label = document.createElement("h6");
                    label.textContent = option.name;
                    wrapper.appendChild(label);

                    // Color as radio swatch
                    if (option.name.toLowerCase() === "color") {
                        let colorContainer = document.createElement("div");
                        colorContainer.className = "color-swatches";
                        option.values.forEach((value, index) => {
                        let input = document.createElement("input");
                        input.type = "radio";
                        input.name = option.name;
                        input.value = value;
                        input.id = `${option.name}-${index}`;
                        
                        let colorBox = document.createElement("label");
                        colorBox.className = "color-box";
                        colorBox.style.backgroundColor = value.toLowerCase(); // assumes value is a color
                        colorBox.setAttribute("for", input.id);
                        
                        colorContainer.appendChild(input);
                        colorContainer.appendChild(colorBox);
                        });
                        wrapper.appendChild(colorContainer);
                    }
                    // Size as dropdown
                    else if (option.name.toLowerCase() === "size") {
                        let select = document.createElement("select");
                        select.name = option.name;
                        option.values.forEach((value) => {
                        let opt = document.createElement("option");
                        opt.value = value;
                        opt.textContent = value;
                        select.appendChild(opt);
                        });
                        wrapper.appendChild(select);
                    }
                    // Default to radio
                    else {
                        let container = document.createElement("div");
                        option.values.forEach((value, index) => {
                        let input = document.createElement("input");
                        input.type = "radio";
                        input.name = option.name;
                        input.value = value;
                        input.id = `${option.name}-${index}`;

                        let label = document.createElement("label");
                        label.setAttribute("for", input.id);
                        label.textContent = value;

                        container.appendChild(input);
                        container.appendChild(label);
                        });
                        wrapper.appendChild(container);
                    }

                    variant_options.appendChild(wrapper);
                    });

                // end here

                // variants loop starts from here
                var variants_main = document.createElement("div");
                variants_main.setAttribute("class","all_variants_main")
                $product.variants.forEach((e) => {
                  let var_input = document.createElement("input");
                  var_input.type = "hidden";
                  var_input.value = e.id;
                  var_input.name = "variant";
                  var_input.dataset.title = e.title;
                  variants_main.appendChild(var_input);
                })
                let variant_wrapper = document.createElement("div");
                variant_wrapper.appendChild(variants_main);
                let final_Variants = variant_wrapper.innerHTML;
                // end

                
                // append all html
                var options_wrapper = document.createElement("div");
                options_wrapper.appendChild(variant_options);
                var string_options_main = options_wrapper.innerHTML;
                var $html = `
                  <div class="product-main">
                    <div class="product-media">
                      <img src="${$product.image.src}" alt="${$product.handle}">
                    </div>
                    <div class="pro-information">
                      ${final_Variants}
                      <h5>${$product.title}</h5>
                      <p class="price">${$product.variants[0].price}</p>
                      <p>${$product.body_html}</p>
                      ${string_options_main}
                      <button type="button" data-id="" class="custom-quick-add">Add to cart</button>
                    </div>
                  </div>
                  `;
                document.querySelector(".quickview_popup .quickview_pro_inner").innerHTML = $html;
                document.querySelector(".quickview_popup").classList.add("active");
                changeOptions($product);
              })
          })
        })
      })
    </script>
{% style %}
    .quickview_popup.active {
      position: fixed;
      z-index: 9999;
      width: 90%;
      max-width: 800px;
      background: #fff;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      overflow-y: auto;
      max-height: 90vh;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }
    
    .quickview_popup .product__description {
      display: none;
    }
    
    .quickview_pro_inner .product-main {
      display: grid;
      grid-template-columns: 1fr 1.5fr;
      gap: 24px;
      align-items: start;
    }
    
    .quickview_pro_inner .product-main img {
      width: 100%;
      border-radius: 8px;
      object-fit: cover;
    }
    
    .pro-information h5 {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .pro-information .price {
      font-size: 1.1rem;
      color: #333;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .main-options {
      margin-bottom: 20px;
    }
    
    .main-options > div {
      margin-bottom: 10px;
    }
    
    .main-options h6 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .main-options label {
      margin-right: 10px;
      cursor: pointer;
      display: inline-block;
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      transition: all 0.2s ease-in-out;
      font-size: 0.9rem;
    }
    
    .main-options input[type="radio"] {
      display: none;
    }
    
    .main-options input[type="radio"]:checked + label,
    .main-options label:has(input[type="radio"]:checked) {
      background-color: #f37a25;
      color: #fff;
      border-color: #f37a25;
    }
    
    .custom-quick-add {
      background-color: #f37a25;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .custom-quick-add:hover {
      background-color: #e26515;
    }
    {% endstyle %}
    

<div class="page-width-desktop">
    <h2 class="title inline-richtext">
        {{ section.settings.heading }}
    </h2>
    <ul
        class="grid product-grid contains-card contains-card--product contains-card--standard grid--3-col-desktop grid--2-col-tablet-down"
        role="list"
    >
    {%- for block in section.blocks -%}
        {%- case block.type -%}
            {%- when 'product_select' -%}
                {%  assign card_product = all_products[block.settings.product]   %}
                {% assign ratio = 1 %}
                <li class="grid__item scroll-trigger animate--slide-in">
                    <div class="card-wrapper product-card-wrapper underline-links-hover">
                        <div class="card card--standard card--media" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
                            <div class="card__inner color-scheme-2 gradient ratio" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
                                <div class="card__media">
                                    <div class="media media--transparent media--hover-effect">
                                        <img
                                            srcset="
                                            {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                                            {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                                            {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                                            {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                                            {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                                            {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                                            {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
                                            "
                                            src="{{ card_product.featured_media | image_url: width: 533 }}"
                                            sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                                            alt="{{ card_product.featured_media.alt | escape }}"
                                            class="motion-reduce"
                                            {% unless lazy_load == false %}
                                            loading="lazy"
                                            {% endunless %}
                                            width="{{ card_product.featured_media.width }}"
                                            height="{{ card_product.featured_media.height }}"
                                        >
                                    </div>
                                </div>
                            </div>
                            <div class="card__content">
                                <div class="quick-add no-js-hidden">
                                    {% assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id %}
                                    <button class="custom-quickview" data-handle="{{ card_product.handle }}" style="position: relative;z-index: 3;">
                                        Quick view
                                    </button>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
        {%- endcase -%}
    {%- endfor -%}
    </ul>
    <div class="quickview_popup">
        <div class="quickview_pro_inner">
            
        </div>
    </div>
</div>

{% schema %}
{
    "name": "t:sections.grid-products.name",
    "tag": "section",
    "class": "section section-grid-product",
    "blocks":[
        {
            "type": "product_select",
            "name": "t:sections.grid-products.settings.product.label",
            "settings": [{
                "type": "product",
                "id": "product",
                "label": "t:sections.grid-products.settings.product.label"
            }]
        }
    ],
    "settings": [
        {
          "type": "inline_richtext",
          "id": "heading",
          "label": "t:sections.grid-products.settings.heading.label"
        },
    ],
    "presets": [
        {
            "name": "t:sections.grid-products.name"
        }
    ]
}
{% endschema %}